<blocks app="Snap4Arduino 1.2.3
 http://snap4arduino.rocks" version="1"><block-definition s="set %&apos;motor name&apos; motor to angle %&apos;angle&apos;" type="command" category="arduino"><header></header><code></code><inputs><input type="%s" readonly="true">base<options>base
shoulder
elbow
hand
wrist
gripper</options></input><input type="%n">90</input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>motorName</l><l>angle</l></list><l>var position = ([&apos;base&apos;, &apos;shoulder&apos;, &apos;elbow&apos;, &apos;hand&apos;, &apos;wrist&apos;, &apos;gripper&apos;]).indexOf(motorName);&#xD;this.arduino.board.sp.write(new Buffer([0xF0, 0xCB, position, angle, 0xF7]));</l></block><list><block var="motor name"/><block var="angle"/></list></block></script></block-definition><block-definition s="change %&apos;motor name&apos; by %&apos;delta&apos; degrees" type="command" category="arduino"><header></header><code></code><inputs><input type="%s" readonly="true">base<options>base
shoulder
elbow
hand
wrist
gripper</options></input><input type="%n">1</input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>motorName</l><l>delta</l></list><l>var position = ([&apos;base&apos;, &apos;shoulder&apos;, &apos;elbow&apos;, &apos;hand&apos;, &apos;wrist&apos;, &apos;gripper&apos;]).indexOf(motorName);&#xD;this.arduino.board.sp.write(new Buffer([0xF0, delta &gt; 0 ? 0xCC : 0xCD, position, Math.abs(delta), 0xF7]));</l></block><list><block var="motor name"/><block var="delta"/></list></block></script></block-definition><block-definition s="%&apos;state&apos; gripper" type="command" category="arduino"><header></header><code></code><inputs><input type="%s" readonly="true">open<options>open
close</options></input></inputs><script><block s="doIfElse"><block s="reportEquals"><block var="state"/><l>open</l></block><script><custom-block s="set %s motor to angle %n"><l>gripper</l><l>10</l></custom-block></script><script><custom-block s="set %s motor to angle %n"><l>gripper</l><l>70</l></custom-block></script></block></script></block-definition><block-definition s="%&apos;motor name&apos; motor angle" type="reporter" category="arduino"><header></header><code></code><inputs><input type="%s" readonly="true">base<options>base
shoulder
elbow
hand
wrist
gripper</options></input></inputs><script><block s="doDeclareVariables"><list><l>angle</l></list></block><block s="doSetVar"><l>angle</l><block s="reportNewList"><list></list></block></block><block s="doRun"><block s="reportJSFunction"><list><l>motorName</l><l>angle</l></list><l>var motor = ([&apos;base&apos;, &apos;shoulder&apos;, &apos;elbow&apos;, &apos;hand&apos;, &apos;wrist&apos;, &apos;gripper&apos;]).indexOf(motorName);&#xD;this.arduino.board.once(&apos;string&apos;, function (data) { angle.add(parseFloat(data)); });&#xD;this.arduino.board.sp.write(new Buffer([0xF0, 0xCE, motor, 0xF7]));</l></block><list><block var="motor name"/><block var="angle"/></list></block><block s="doWaitUntil"><block s="reportEquals"><block s="reportListLength"><block var="angle"/></block><l>1</l></block></block><block s="doReport"><block s="reportListItem"><l>1</l><block var="angle"/></block></block></script><scripts><comment x="291" y="260.2" w="277" collapsed="false">We use a list because we need some kind of variable that&apos;s passed as a reference to the JS function. A numeric type would not work, as it&apos;s passed by value and thus the original value can&apos;t be changed from inside the &quot;run&quot; block.</comment></scripts></block-definition><block-definition s="gripper open?" type="predicate" category="arduino"><header></header><code></code><inputs></inputs><script><block s="doReport"><block s="reportLessThan"><custom-block s="%s motor angle"><l>gripper</l></custom-block><l>65</l></block></block></script></block-definition></blocks>
