<blocks app="Snap! 10, https://snap.berkeley.edu" version="2"><palette><category name="MicroBlocks" color="97,101,255,1"/></palette><block-definition s="init BLE extension" type="command" category="MicroBlocks" helper="true"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doSetVar"><l>__module__ble__</l><l>libraries/ble/init.js</l></block></script></block-definition><block-definition s="connect to MicroBlocks via %&apos;port type&apos;" type="command" category="MicroBlocks"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true" initial="1">USB<options>BLE&#xD;USB</options></input></inputs><script><block s="doSetVar"><l>__mb_buffer__</l><block s="reportNewList"><list></list></block></block><block s="doIf"><custom-block s="connected to MicroBlocks"></custom-block><script><custom-block s="disconnect from MicroBlocks"></custom-block></script><list></list></block><block s="doIf"><block s="reportVariadicEquals"><list><block var="port type"/><l>BLE</l></list></block><script><block s="doApplyExtension"><l>ble_connect(serviceUUID, rxUUIX, txUUID)</l><list><l>bb37a001-b922-4018-8e74-e14824b3a638</l><l>bb37a002-b922-4018-8e74-e14824b3a638</l><l>bb37a003-b922-4018-8e74-e14824b3a638</l></list></block></script><list><l><bool>true</bool></l><script><block s="doSetVar"><l>__mb_serial_port__</l><block s="reportApplyExtension"><l>srl_open(baud, buffer)</l><list><l>115200</l><l>15000</l></list></block></block></script></list></block><block s="doWaitUntil"><custom-block s="connected to MicroBlocks"></custom-block></block><block s="doSetVar"><l>__mb_lastBroadcastTime__</l><block s="reportDate"><l><option>time in milliseconds</option></l></block></block></script></block-definition><block-definition s="broadcast %&apos;message&apos; to MicroBlocks" type="command" category="MicroBlocks"><header></header><code></code><translations></translations><inputs><input type="%s"></input></inputs><script><block s="doIf"><custom-block s="connected to MicroBlocks"></custom-block><script><block s="doDeclareVariables"><list><l>len</l><l>bytes</l></list></block><block s="doWarp"><script><block s="doSetVar"><l>len</l><block s="reportVariadicSum"><list><block s="reportTextAttribute"><l><option>length</option></l><block var="message"/></block><l>1</l></list></block></block><block s="doSetVar"><l>bytes</l><block s="reportNewList"><list><l>251</l><l>27</l><l>0</l><block s="reportModulus"><block var="len"/><l>256</l></block><block s="reportMonadic"><l><option>floor</option></l><block s="reportQuotient"><block var="len"/><l>256</l></block></block></list></block></block><block s="doForEach"><l>i</l><block s="reportNumbers"><l>1</l><block s="reportTextAttribute"><l><option>length</option></l><block var="message"/></block></block><script><block s="doAddToList"><block s="reportUnicode"><block s="reportLetter"><block var="i"/><block var="message"/></block></block><block var="bytes"/></block></script></block><block s="doAddToList"><l>254</l><block var="bytes"/></block></script></block><block s="doIf"><block s="reportVariadicEquals"><list><block var="__mb_serial_port__"/><l></l></list></block><script><block s="doApplyExtension"><l>ble_write(data)</l><list><block var="bytes"/></list></block></script><list><l><bool>true</bool></l><script><block s="doApplyExtension"><l>srl_write(port, bytes)</l><list><block var="__mb_serial_port__"/><block var="bytes"/></list></block></script></list></block></script><list></list></block></script></block-definition><block-definition s="skip to next long message" type="command" category="MicroBlocks" helper="true"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doDeclareVariables"><list><l>i</l><l>msgLen</l></list></block><block s="doUntil"><block s="reportListIsEmpty"><block var="__mb_buffer__"/></block><script><block s="doSetVar"><l>i</l><block s="reportListIndex"><l>251</l><block var="__mb_buffer__"/></block></block><block s="doIf"><block s="reportVariadicEquals"><list><block var="i"/><l>0</l></list></block><script><block s="doSetVar"><l>__mb_buffer__</l><block s="reportNewList"><list></list></block></block></script><list><l><bool>true</bool></l><script><block s="doSetVar"><l>__mb_buffer__</l><block s="reportListItem"><block s="reportNumbers"><block var="i"/><block s="reportListAttribute"><l><option>length</option></l><block var="__mb_buffer__"/></block></block><block var="__mb_buffer__"/></block></block><block s="doIf"><block s="reportVariadicLessThan"><list><block s="reportListAttribute"><l><option>length</option></l><block var="__mb_buffer__"/></block><l>5</l></list></block><script><block s="doReport"><l></l><comment w="90" collapsed="true">Incomplete</comment></block></script><list></list></block><block s="doSetVar"><l>msgLen</l><block s="reportVariadicSum"><list><block s="reportVariadicProduct"><list><block s="reportListItem"><l>5</l><block var="__mb_buffer__"/></block><l>256</l></list></block><block s="reportListItem"><l>4</l><block var="__mb_buffer__"/></block></list></block></block><block s="doIfElse"><block s="reportVariadicAnd"><list><block s="reportVariadicLessThan"><list><block s="reportListItem"><l>2</l><block var="__mb_buffer__"/></block><l>48</l></list></block><block s="reportVariadicLessThan"><list><block var="msgLen"/><l>1024</l></list></block></list></block><script><block s="doReport"><l></l><comment w="90" collapsed="true">Valid long msg</comment></block></script><script><block s="doSetVar"><l>__mb_buffer__</l><block s="reportCDR"><block var="__mb_buffer__"/></block><comment w="113" collapsed="true">skip bad msg (unlikely)</comment></block></script></block></script></list></block></script></block></script></block-definition><block-definition s="__mb_process_data__" type="command" category="MicroBlocks" helper="true"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doDeclareVariables"><list><l>newData</l><l>msgLen</l><l>msgType</l><l>msgBody</l><l>msgParts</l></list></block><block s="doIf"><block s="reportVariadicEquals"><list><block var="__mb_serial_port__"/><l></l></list></block><script><block s="doSetVar"><l>__mb_buffer__</l><block s="reportConcatenatedLists"><list><block var="__mb_buffer__"/><block s="reportApplyExtension"><l>ble_read()</l><list></list></block></list></block></block></script><list><l><bool>true</bool></l><script><block s="doSetVar"><l>newData</l><block s="reportApplyExtension"><l>srl_read(port)</l><list><block var="__mb_serial_port__"/></list></block></block><block s="doIf"><block s="reportIsA"><block var="newData"/><l><option>list</option></l></block><script><block s="doSetVar"><l>__mb_buffer__</l><block s="reportConcatenatedLists"><list><block var="__mb_buffer__"/><block var="newData"/></list></block></block></script><list></list></block></script></list></block><block s="doIf"><block s="reportNot"><block s="reportListIsEmpty"><block var="__mb_buffer__"/></block></block><script><custom-block s="skip to next long message"></custom-block><block s="doUntil"><block s="reportVariadicLessThan"><list><block s="reportListAttribute"><l><option>length</option></l><block var="__mb_buffer__"/></block><l>5</l></list></block><script><block s="doSetVar"><l>msgLen</l><block s="reportVariadicSum"><list><block s="reportVariadicProduct"><list><block s="reportListItem"><l>5</l><block var="__mb_buffer__"/></block><l>256</l></list></block><block s="reportListItem"><l>4</l><block var="__mb_buffer__"/></block></list></block></block><block s="doIf"><block s="reportVariadicGreaterThanOrEquals"><list><block s="reportListAttribute"><l><option>length</option></l><block var="__mb_buffer__"/></block><block s="reportVariadicSum"><list><block var="msgLen"/><l>5</l></list></block></list></block><script><block s="doSetVar"><l>msgType</l><block s="reportListItem"><l>2</l><block var="__mb_buffer__"/></block></block><block s="doSetVar"><l>msgBody</l><block s="reportListItem"><block s="reportNumbers"><l>6</l><block s="reportVariadicSum"><list><l>5</l><block var="msgLen"/></list></block></block><block var="__mb_buffer__"/></block></block><block s="doIf"><block s="reportVariadicAnd"><list><block s="reportVariadicEquals"><list><block var="msgType"/><l>27</l></list></block><block s="reportVariadicGreaterThan"><list><block s="reportDate"><l><option>time in milliseconds</option></l></block><block s="reportVariadicSum"><list><block var="__mb_lastBroadcastTime__"/><l>50</l></list></block></list></block></list></block><script><block s="doSetVar"><l>msgParts</l><block s="reportTextSplit"><block s="reportJoinWords"><list><block s="reportUnicodeAsLetter"><block var="msgBody"/></block></list></block><l>,</l></block></block><custom-block s="broadcast threadsafely %s %receive"><block s="reportListItem"><l>1</l><block var="msgParts"/></block><list><l><option>all</option></l><block s="reportIfElse"><block s="reportVariadicGreaterThan"><list><block s="reportListAttribute"><l><option>length</option></l><block var="msgParts"/></block><l>1</l></list></block><block s="reportIfElse"><block s="reportVariadicEquals"><list><block s="reportListAttribute"><l><option>length</option></l><block var="msgParts"/></block><l>2</l></list></block><block s="reportListItem"><l>2</l><block var="msgParts"/></block><block s="reportCDR"><block var="msgParts"/></block></block><l></l></block></list></custom-block><block s="doDeleteFromList"><l><option>all</option></l><block var="__mb_buffer__"/></block><block s="doSetVar"><l>__mb_lastBroadcastTime__</l><block s="reportDate"><l><option>time in milliseconds</option></l></block></block></script><list></list></block><block s="doIf"><block s="reportVariadicAnd"><list><block s="reportVariadicEquals"><list><block var="msgType"/><l>20</l></list></block><block s="reportVariadicEquals"><list><block s="reportListItem"><l>3</l><block var="__mb_buffer__"/></block><l>254</l></list></block><block s="reportVariadicEquals"><list><block s="reportListItem"><l>1</l><block var="msgBody"/></block><l>2</l></list></block><block s="reportVariadicGreaterThan"><list><block s="reportDate"><l><option>time in milliseconds</option></l></block><block s="reportVariadicSum"><list><block var="__mb_lastBroadcastTime__"/><l>50</l></list></block></list></block></list></block><script><block s="doSetVar"><l>msgParts</l><block s="reportTextSplit"><block s="reportJoinWords"><list><block s="reportUnicodeAsLetter"><block s="reportCDR"><block var="msgBody"/></block></block></list></block><l><option>word</option></l></block></block><custom-block s="broadcast threadsafely %s %receive"><l>graph</l><list><l><option>all</option></l><block s="reportIfElse"><block s="reportVariadicEquals"><list><block s="reportListAttribute"><l><option>length</option></l><block var="msgParts"/></block><l>1</l></list></block><block s="reportListItem"><l>1</l><block var="msgParts"/></block><block var="msgParts"/></block></list></custom-block><block s="doDeleteFromList"><l><option>all</option></l><block var="__mb_buffer__"/></block><block s="doSetVar"><l>__mb_lastBroadcastTime__</l><block s="reportDate"><l><option>time in milliseconds</option></l></block></block></script><list></list></block><block s="doIfElse"><block s="reportVariadicLessThanOrEquals"><list><block s="reportListAttribute"><l><option>length</option></l><block var="__mb_buffer__"/></block><block s="reportVariadicSum"><list><block var="msgLen"/><l>5</l></list></block></list></block><script><block s="doSetVar"><l>__mb_buffer__</l><block s="reportNewList"><list></list></block></block></script><script><block s="doSetVar"><l>__mb_buffer__</l><block s="reportListItem"><block s="reportNumbers"><block s="reportVariadicSum"><list><block var="msgLen"/><l>6</l></list></block><block s="reportListAttribute"><l><option>length</option></l><block var="__mb_buffer__"/></block></block><block var="__mb_buffer__"/></block></block></script></block></script><list><l><bool>true</bool></l><script><block s="doReport"><l></l></block></script></list></block></script></block></script><list></list></block></script></block-definition><block-definition s="disconnect from MicroBlocks" type="command" category="MicroBlocks"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doApplyExtension"><l>ble_disconnect()</l><list></list></block><block s="doApplyExtension"><l>srl_close(port)</l><list><block var="__mb_serial_port__"/></list></block><block s="doSetVar"><l>__mb_serial_port__</l><l></l></block></script></block-definition><block-definition s="connected to MicroBlocks" type="predicate" category="MicroBlocks"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doReport"><block s="reportVariadicOr"><list><block s="reportApplyExtension"><l>ble_connected()</l><list></list></block><block s="reportNot"><block s="reportVariadicEquals"><list><block var="__mb_serial_port__"/><l></l></list></block></block></list></block></block></script></block-definition><block-definition s="broadcast threadsafely %&apos;msg&apos; %&apos;payload&apos;" type="command" category="control" helper="true"><header></header><code></code><translations></translations><inputs><input type="%s" initial="1"><options>§_messagesMenu</options></input><input type="%receive" irreplaceable="true" initial="1"></input></inputs><script><block s="doDeclareVariables"><list><l>threadsafe</l></list></block><block s="doSetVar"><l>threadsafe</l><block s="reportApplyExtension"><l>snap_threadsafe?</l><list></list></block></block><block s="doApplyExtension"><l>snap_threadsafe(on?)</l><list><block s="reportBoolean"><l><bool>true</bool></l></block></list></block><block s="doBroadcast"><block var="msg"/><list><block s="reportListItem"><l>1</l><block var="payload"/></block><block s="reportListItem"><l>2</l><block var="payload"/></block></list></block><block s="doApplyExtension"><l>snap_threadsafe(on?)</l><list><block var="threadsafe"/></list></block></script></block-definition><variables><variable name="__module__ble__" hidden="true"><l>libraries/ble/init.js</l></variable><variable name="__mb_buffer__" hidden="true"><list struct="atomic" id="2">251</list></variable><variable name="__mb_lastBroadcastTime__" hidden="true"><l>1728466396058</l></variable><variable name="__mb_serial_port__" hidden="true"><l></l></variable></variables></blocks>